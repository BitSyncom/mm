#!/bin/bash

# Automated Continuous Integration configuration

# Files generated by Automated Continuous Integration script
#BASEDIR=
TIMEOUT=25              # minute
WORKDIR=$HOME/public_html/mm
GITBRANCH=avalon4
[ ! -d $WORKDIR ] && mkdir -p $WORKDIR

function my_mail()
{
        #FROM_EMAIL_ADDRESS=email_account@163.com
        #EMAIL_ACCOUNT_PASSWORD=email_password
        #FRIENDLY_NAME=Any_Name_for_Display
        #SMTP_ADDRESS="smtp://smtp.163.com"
        #TO_EMAIL_LIST="user1@xxx.com user2@xxx.com"
        [ ! -r $BASEDIR/email.conf ] && return 0
        ! which mailx > /dev/null 2>&1 && return 0
        . $BASEDIR/email.conf

        EMAIL_SUBJECT="$1"
        EMAIL_CONTENT="$2"
        for TO_EMAIL_ADDRESS in $TO_EMAIL_LIST; do
                echo "$EMAIL_CONTENT" | tr -cd '[:print:]\n' | mailx -v -s "$EMAIL_SUBJECT" \
                -S smtp-use-starttls \
                -S ssl-verify=ignore \
                -S smtp-auth=login \
                -S smtp="$SMTP_ADDRESS" \
                -S from="$FROM_EMAIL_ADDRESS($FRIENDLY_NAME)" \
                -S smtp-auth-user=$FROM_EMAIL_ADDRESS \
                -S smtp-auth-password=$EMAIL_ACCOUNT_PASSWORD \
                -S ssl-verify=ignore \
                $TO_EMAIL_ADDRESS

                # Not spam
                sleep 5
        done
}
